<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Logs Administrativos</h2>
        <a href="/admin" class="btn btn-outline-dark btn-sm">
            <i class="fas fa-th-large me-1"></i> Painel Geral Admin
        </a>
    </div>

    {{#if logs.length}}

    <div class="table-responsive">
        <table class="table table-hover align-middle border">
            <thead class="table-dark">
                <tr>
                    <th style="width: 15%">A칞칚o</th>
                    <th style="width: 20%">Administrador</th>
                    <th style="width: 20%">Usu치rio Afetado</th>
                    <th style="width: 15%">IP</th>
                    <th style="width: 20%">Data/Hora</th>
                    <th class="text-center" style="width: 10%">Detalhes</th>
                </tr>
            </thead>
            <tbody>
                {{#each logs}}
                <tr>
                    <td>
                        {{#if (eq this.action "UPDATE_USER")}}
                        <span class="badge bg-warning text-dark"><i class="fas fa-edit me-1"></i> Atualiza칞칚o</span>
                        {{else if (eq this.action "DELETE_USER")}}
                        <span class="badge bg-danger"><i class="fas fa-trash-alt me-1"></i> Exclus칚o</span>
                        {{else if (eq this.action "VIEW_ACCOUNTS_LIST")}}
                        <span class="badge bg-info text-dark"><i class="fas fa-eye me-1"></i> Listagem</span>
                        {{else}}
                        <span class="badge bg-secondary">{{this.action}}</span>
                        {{/if}}
                    </td>

                    <td>
                        <div class="fw-bold">{{this.adminId.firstName}} {{this.adminId.lastName}}</div>
                        <small class="text-muted d-block">{{this.adminId.email}}</small>
                    </td>

                    <td>
                        {{#if this.targetUserId}}
                        <div class="fw-bold">{{this.targetUserId.firstName}} {{this.targetUserId.lastName}}</div>
                        <small class="text-muted d-block">{{this.targetUserId.email}}</small>
                        {{else}}
                        <span class="text-muted italic"><i class="fas fa-user-slash me-1"></i> Conta removida</span>
                        {{/if}}
                    </td>

                    <td>
                        <code class="text-primary bg-light px-1 rounded">{{this.ip}}</code>
                        {{#if this.userAgent}}
                        <i class="fas fa-info-circle text-muted ms-1" title="{{this.userAgent}}"
                            style="cursor: help;"></i>
                        {{/if}}
                    </td>

                    <td>
                        <span class="text-secondary small fw-bold">{{formatFullDateTime this.createdAt}}</span>
                    </td>

                    <td class="text-center">
                        {{#if this.changes}}
                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                            data-bs-target="#changes-{{this._id}}">
                            <i class="fas fa-search-plus"></i> Ver
                        </button>
                        {{/if}}
                    </td>
                </tr>

                {{#if this.changes}}
                <tr class="collapse" id="changes-{{this._id}}">
                    <td colspan="6" class="p-0">
                        <div class="bg-light p-4 border-start border-4 border-primary shadow-sm mx-3 my-2 rounded">
                            <h6 class="mb-3"><i class="fas fa-exchange-alt me-2"></i> Detalhes da Altera칞칚o:</h6>
                            <div class="row">
                                {{#each this.changes}}
                                <div class="col-md-4 mb-3">
                                    <div class="card card-body h-100 py-2 border-0 shadow-sm">
                                        <div class="text-uppercase small fw-bold text-muted mb-2 border-bottom pb-1">
                                            {{@key}}</div>
                                        {{#if this.before}}
                                        <div class="mb-1">
                                            <small class="text-danger fw-bold">DE:</small>
                                            <span class="ms-1">{{this.before}}</span>
                                        </div>
                                        <div>
                                            <small class="text-success fw-bold">PARA:</small>
                                            <span class="ms-1">{{this.after}}</span>
                                        </div>
                                        {{else}}
                                        <div class="bg-white p-2 border rounded small">
                                            {{#if (eq @key "deletedUser")}}
                                            <span class="text-danger fw-bold"><i class="fas fa-info-circle"></i> Dados
                                                Exclu칤dos:</span>
                                            <ul class="mb-0 mt-1 list-unstyled">
                                                <li><strong>Nome:</strong> {{this.firstName}} {{this.lastName}}</li>
                                                <li><strong>Email:</strong> {{this.email}}</li>
                                                <li><strong>Perfil:</strong> {{this.role}}</li>
                                            </ul>
                                            {{else}}
                                            <pre class="mb-0">{{json this}}</pre>
                                            {{/if}}
                                        </div>
                                        {{/if}}
                                    </div>
                                </div>
                                {{/each}}
                            </div>
                        </div>
                    </td>
                </tr>
                {{/if}}

                {{/each}}
            </tbody>
        </table>
    </div> <!-- fecha table-responsive -->

    <!-- 游댝 PAGINA칂츾O -->
    {{#if totalPages}}
    <nav class="mt-4">
        <ul class="pagination justify-content-center">

            <!-- Anterior -->
            {{#if hasPrev}}
            <li class="page-item">
                <a class="page-link" href="?page={{prevPage}}">
                    Anterior
                </a>
            </li>
            {{else}}
            <li class="page-item disabled">
                <span class="page-link">Anterior</span>
            </li>
            {{/if}}

            <!-- P치gina Atual -->
            <li class="page-item active">
                <span class="page-link">
                    P치gina {{currentPage}} de {{totalPages}}
                </span>
            </li>

            <!-- Pr칩xima -->
            {{#if hasNext}}
            <li class="page-item">
                <a class="page-link" href="?page={{nextPage}}">
                    Pr칩xima
                </a>
            </li>
            {{else}}
            <li class="page-item disabled">
                <span class="page-link">Pr칩xima</span>
            </li>
            {{/if}}

        </ul>
    </nav>
    {{/if}}






    {{else}}

    <div class="alert alert-info">
        Nenhum log encontrado.
    </div>

    {{/if}}

</div>