<main class="container my-5">
  <h2 class="text-center mb-4 main-title">
    Bem-vindo(a), {{user.firstName}} {{user.lastName}}!
  </h2>
  <p class="text-center mb-5 text-muted">Voc√™ est√° logado(a).</p>

  <style>
    .btn-custom-outline {
      color: #4f0e21;
      border-color: #4f0e21;
      background-color: transparent;
      transition: all 0.3s ease;
    }

    .btn-custom-outline:hover {
      background-color: #4f0e21;
      color: white;
    }

    .btn-custom-fill {
      background-color: #4f0e21;
      color: white;
      border: 1px solid #4f0e21;
      transition: all 0.3s ease;
    }

    .btn-custom-fill:hover {
      background-color: #6a132c;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(79, 14, 33, 0.2);
    }

    .smaller {
      font-size: 0.75rem;
    }
  </style>

  <!-- Bot√£o Sair e Criar -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-5 gap-3">
    <a href="/memorial/create-step1" class="btn btn-custom-fill btn-lg rounded-pill px-4">
      <i class="fas fa-plus me-2"></i> Criar Novo Memorial
    </a>
    <a href="/auth/logout" class="btn btn-custom-fill btn-lg rounded-pill px-4">
      <i class="fas fa-sign-out-alt me-2"></i> Sair
    </a>
  </div>

  <!-- üîç Filtro de Busca (Card Separado) -->
  <div class="card border-0 shadow-sm mb-5 rounded-4">
    <div class="card-body p-4">
      <form action="/auth/dashboard" method="GET" class="text-center">
        <div class="mx-auto mb-3" style="max-width: 600px;">
          <input type="text" name="q" class="form-control form-control-lg" placeholder="Buscar em seus memoriais...">
        </div>

        <div class="d-flex justify-content-center gap-3">
          <button type="submit" class="btn btn-custom-outline btn-sm rounded-pill px-5">Buscar</button>
          <a href="/auth/dashboard" class="btn btn-custom-outline btn-sm rounded-pill px-5">Ver Todos</a>
        </div>
      </form>
    </div>
  </div>

  <!-- üìã Lista de Memoriais (Card Separado) -->
  <div class="card border-0 shadow-sm mb-4 rounded-4">
    <div class="card-body p-4">
      <h5 class="text-center mb-4"><strong>Seus Memoriais</strong></h5>

      {{#if memoriais.length}}
      <div class="list-group list-group-flush border-0">

        {{#each memoriais}}
        <div class="list-group-item position-relative py-4 border-bottom px-0">

          <!-- ‚≠ê Selo Premium -->
          {{#if (eq this.plan "premium")}}
          <span
            class="badge bg-warning text-dark position-absolute top-0 end-0 m-2 rounded-pill px-3 py-1 smaller shadow-sm">
            ‚≠ê Premium
          </span>
          {{/if}}

          <!-- BLOCO PRINCIPAL -->
          <div class="row align-items-center g-3 justify-content-start text-center text-md-start">

            <!-- FOTO -->
            <div class="col-md-auto">
              <a href="/memorial/{{this.slug}}">
                {{#if this.mainPhoto.url}}
                <img src="{{this.mainPhoto.url}}" alt="Foto de {{this.firstName}}" class="rounded shadow-sm"
                  style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #4f0e21;" />
                {{else}}
                <img src="/images/default-profile.png" alt="Sem foto" class="rounded shadow-sm"
                  style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #ccc;" />
                {{/if}}
              </a>
            </div>

            <!-- INFORMA√á√ïES -->
            <div class="col-md">
              <h4 class="fw-bold mb-1" style="color: #4f0e21;">
                {{this.firstName}} {{this.lastName}}
              </h4>

              <div class="mb-2 text-muted smaller">
                <span class="d-inline-block me-3"><strong>Nascimento:</strong> {{formatDate this.birth.date}}</span>
                <br>
                <span class="d-inline-block"><strong>Falecimento:</strong> {{formatDate this.death.date}}</span>
              </div>

              <!-- LINHA: Visibilidade + Plano -->
              <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-start gap-2">

                <div class="smaller">
                  {{#if (eq this.accessLevel "public_read")}}
                  <span
                    class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-2 py-0">P√∫blico</span>
                  {{else}}
                  <span
                    class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill px-2 py-0">Privado</span>
                  {{/if}}
                </div>

                <div class="smaller">
                  {{#if (eq this.plan "premium")}}
                  <span
                    class="badge bg-warning-subtle text-dark border border-warning-subtle rounded-pill px-2 py-0">Premium</span>
                  {{else}}
                  <span class="badge bg-light text-dark border rounded-pill px-2 py-0">Free</span>
                  {{/if}}
                </div>

              </div>

            </div>

            <!-- BOT√ïES DE A√á√ÉO -->
            <div
              class="col-xl-auto col-lg-12 text-center text-md-end mt-3 mt-md-0 d-flex flex-wrap gap-2 justify-content-center justify-content-xl-end">
              <a href="/memorial/{{this.slug}}" class="btn btn-custom-outline btn-sm rounded-pill px-3 py-1">
                Visitar
              </a>
              <a href="/memorial/{{this.slug}}/memorial-fet/edit"
                class="btn btn-custom-outline btn-sm rounded-pill px-3 py-1">
                Foto
              </a>
              <a href="/memorial/{{this.slug}}/memorial/edit"
                class="btn btn-custom-outline btn-sm rounded-pill px-3 py-1">
                Editar
              </a>
              <a href="/memorial/{{this.slug}}/memorial/privacy/edit"
                class="btn btn-custom-outline btn-sm rounded-pill px-3 py-1">
                Privacidade
              </a>
              <form action="/memorial/{{this.slug}}/delete" method="POST" class="d-inline"
                onsubmit="return confirm('Tem certeza que deseja apagar este memorial?')">
                <input type="hidden" name="_method" value="DELETE" />
                <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3 py-1">
                  Excluir
                </button>
              </form>
            </div>

          </div>

        </div>
        {{/each}}

      </div>

      <!-- üî¢ Pagina√ß√£o -->
      {{#if pagination.totalPages}}
      <nav aria-label="Navega√ß√£o de p√°ginas" class="mt-5">
        <ul class="pagination pagination-sm justify-content-center gap-1">

          <li class="page-item {{#unless pagination.hasPrev}}disabled{{/unless}} mx-1">
            <a class="page-link rounded-pill px-3 border-0 shadow-sm" style="color: #4f0e21;"
              href="?page={{pagination.prevPage}}&q={{query}}">
              Anterior
            </a>
          </li>

          {{#each (range 1 pagination.totalPages)}}
          <li class="page-item {{#if (eq this ../pagination.currentPage)}}active{{/if}} mx-1">
            <a class="page-link rounded-pill border-0 shadow-sm text-center d-flex align-items-center justify-content-center"
              style="width: 35px; height: 35px; {{#if (eq this ../pagination.currentPage)}}background-color: #4f0e21; color: white;{{else}}color: #4f0e21;{{/if}}"
              href="?page={{this}}&q={{../query}}">{{this}}</a>
          </li>
          {{/each}}

          <li class="page-item {{#unless pagination.hasNext}}disabled{{/unless}} mx-1">
            <a class="page-link rounded-pill px-3 border-0 shadow-sm" style="color: #4f0e21;"
              href="?page={{pagination.nextPage}}&q={{query}}">
              Pr√≥ximo
            </a>
          </li>

        </ul>
      </nav>
      <div class="text-center text-muted smaller mt-3">
        P√°gina {{pagination.currentPage}} de {{pagination.totalPages}}
      </div>
      {{/if}}

      {{else}}
      <div class="py-5 text-center">
        <p class="text-muted">
          {{#if query}}
          Nenhum memorial encontrado para "<strong>{{query}}</strong>".
          {{else}}
          Voc√™ ainda n√£o criou nenhum memorial.
          {{/if}}
        </p>
        {{#if query}}
        <a href="/auth/dashboard" class="btn btn-link link-primary smaller text-decoration-none">Ver todos os seus
          memoriais</a>
        {{/if}}
      </div>
      {{/if}}

    </div>
  </div>

</main>