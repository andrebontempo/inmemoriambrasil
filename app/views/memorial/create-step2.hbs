<main class="container my-5">

  <!-- WRAPPER CENTRALIZADO -->
  <div class="d-flex justify-content-center">
    <form action="/memorial/create-step2" method="POST"
      class="main-form main-form-box main-card p-4 rounded-4 shadow-sm">
      <h2 class="main-title text-center mb-4 fw-bold">
        Dados do Homenageado(2/4)
      </h2>
      <!-- üü¶ G√™nero 
      <div class="mb-4">
        <label class="form-label fw-bold">G√™nero</label>
        <select name="gender" class="form-select" required>
          <option value="">Selecione</option>
          <option value="male" {{#if (eq step1Data.gender "male")}}selected{{/if}}>Masculino</option>
          <option value="female" {{#if (eq step1Data.gender "female")}}selected{{/if}}>Feminino</option>
        </select>
      </div>
      -->
      <!-- üü¶ Parentesco -->
      <div class="mb-4">
        <label class="form-label fw-bold">Parentesco</label>
        <select name="kinship" class="form-select" required>
          <option value="">Selecione</option>
          {{#each kinships}}
          <option value="{{value}}" {{#if (eq ../step1Data.kinship value)}}selected{{/if}}>
            {{label}}
          </option>
          {{/each}}
        </select>
      </div>

      <hr class="my-4">

      <!-- üå± NASCIMENTO -->
      <h4 class="text-primary fw-bold mb-3">üìç Data e Local de Nascimento</h4>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Data</label>
          <input type="date" name="birth.date" class="form-control" value="{{step1Data.birth.date}}" required>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Estado (UF)</label>
          <select id="birthState" name="birth.state" class="form-select" required>
            <option value="">Selecione o estado</option>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Cidade</label>
          <select id="birthCity" name="birth.city" class="form-select" required>
            <option value="">Selecione o estado primeiro</option>
          </select>
        </div>
      </div>

      <hr class="my-4">

      <!-- üïäÔ∏è FALECIMENTO -->
      <h4 class="text-primary fw-bold mb-3">üïäÔ∏è Data e Local de Falecimento</h4>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Data</label>
          <input type="date" name="death.date" class="form-control" value="{{step1Data.death.date}}" required>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Estado (UF)</label>
          <select id="deathState" name="death.state" class="form-select" required>
            <option value="">Selecione o estado</option>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">Cidade</label>
          <select id="deathCity" name="death.city" class="form-select" required>
            <option value="">Selecione o estado primeiro</option>
          </select>
        </div>
      </div>

      <div class="text-center mt-5">
        <button type="submit" class="btn btn-primary btn-lg px-4 rounded-pill">
          Avan√ßar
        </button>
      </div>

    </form>
  </div>

</main>

<script>
  // Fun√ß√£o para carregar estados
  function loadStates(selectId) {
    const select = document.getElementById(selectId);

    fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome")
      .then(res => res.json())
      .then(states => {
        states.forEach(state => {
          const opt = document.createElement("option");
          opt.value = state.sigla;
          opt.textContent = `${state.nome} (${state.sigla})`;
          select.appendChild(opt);
        });
      });
  }

  // Fun√ß√£o para carregar cidades com base no UF
  function loadCities(stateSelectId, citySelectId) {
    const stateSelect = document.getElementById(stateSelectId);
    const citySelect = document.getElementById(citySelectId);

    stateSelect.addEventListener("change", () => {
      const uf = stateSelect.value;
      citySelect.innerHTML = `<option value="">Carregando...</option>`;

      fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`)
        .then(res => res.json())
        .then(cities => {
          citySelect.innerHTML = `<option value="">Selecione a cidade</option>`;
          cities.forEach(city => {
            const opt = document.createElement("option");
            opt.value = city.nome;
            opt.textContent = city.nome;
            citySelect.appendChild(opt);
          });
        });
    });
  }

  // Inicializa (nascimento)
  loadStates("birthState");
  loadCities("birthState", "birthCity");

  // Inicializa (falecimento)
  loadStates("deathState");
  loadCities("deathState", "deathCity");
</script>