<main>

  <!-- Cabeçalho explicativo -->
  <div class="custom-box my-2 mx-0">
    <h3 class="section-title">
      <i class="bi bi-chat-left-heart me-2"></i>
      Conte pra gente...
    </h3>

    <p class="section-text">
      Neste espaço, familiares, amigos e pessoas queridas são convidados a compartilhar lembranças
      significativas vividas ao lado de
      <strong>{{firstName}} {{lastName}}</strong>.  
      Aqui construímos juntos uma narrativa afetiva feita de momentos únicos e especiais.
    </p>
  </div>


  <!-- Lista de histórias compartilhadas -->
  <div class="custom-box my-2 mx-0 text-start">

    {{#if sharedStory.length}}
      {{#each sharedStory}}

        <div class="life-card">
          <div class="life-content">

            <div class="life-text">
              <h4 class="life-title">{{this.title}}</h4>

              <small class="life-date">
                <i class="bi bi-calendar-event"></i>
                {{#if this.eventDate}}
                  {{formatDate this.eventDate "long"}}
                {{else}}
                  Data não informada
                {{/if}}
              </small>

              <p class="life-body">
                {{this.content}}
              </p>

              <div class="life-footer">
                <span class="life-author">
                  Publicado por <strong>{{this.user.firstName}} {{this.user.lastName}}</strong>
                  em {{formatDate this.createdAt "default"}}
                </span>

                <div class="life-actions">
                  <a 
                    href="/memorial/{{../slug}}/sharedstory/edit/{{this._id}}" 
                    class="life-icon edit"
                    title="Editar"
                  >
                    <i class="bi bi-pencil"></i>
                  </a>

                  <form 
                    action="/memorial/{{../slug}}/sharedstory/delete/{{this._id}}" 
                    method="POST"
                    onsubmit="return confirm('Deseja realmente excluir esta história?');"
                  >
                    <button type="submit" class="life-icon delete" title="Apagar">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </div>

              </div>
            </div>

            <div class="life-image">
              <img 
                src="{{this.image.url}}" 
                alt="Imagem da história"
              />
            </div>

          </div>
        </div>

      {{/each}}

    {{else}}
      <p>Nenhuma história compartilhada ainda.</p>
    {{/if}}

  </div>


  <!-- Formulário igual ao LifeStory -->
  <form action="/memorial/{{slug}}/sharedstory/create"
        method="POST"
        enctype="multipart/form-data">

    <input type="hidden" name="memorial" value="{{id}}" />
    <input type="hidden" name="slug" value="{{slug}}" />

    <div class="life-form-box">
      <div class="life-form-card">

        <h3 class="life-form-title">
          <i class="bi bi-pencil-square me-2"></i>Compartilhe sua História
        </h3>

        <!-- Título -->
        <div class="mb-3">
          <label for="storyTitle" class="life-label">
            <i class="bi bi-bookmark-fill"></i> Título da História
          </label>
          <input type="text" id="storyTitle" name="title" class="life-input" required>
        </div>

        <!-- Conteúdo -->
        <div class="mb-3">
          <label for="storyContent" class="life-label">
            <i class="bi bi-chat-left-text"></i> Conteúdo
          </label>
          <textarea id="storyContent" name="content" rows="5" class="life-input" required></textarea>
        </div>

        <!-- Data -->
        <div class="mb-3">
          <label for="eventDate" class="life-label">
            <i class="bi bi-calendar-event"></i> Data do Acontecimento
          </label>
          <input type="date" id="eventDate" name="eventDate" class="life-input" required>
        </div>

        <!-- Imagem -->
        <div class="mb-3">
          <label for="storyImage" class="life-label">
            <i class="bi bi-image"></i> Adicionar uma imagem
          </label>
          <input type="file" id="storyImage" name="file" class="life-input" accept="image/*">
        </div>

        <div class="life-form-footer">
          <span class="life-author small">Por usuário logado.</span>

          <button type="submit" class="life-submit-btn">
            <i class="bi bi-send-fill me-1"></i> Enviar História
          </button>
        </div>

      </div>
    </div>

  </form>

</main>
