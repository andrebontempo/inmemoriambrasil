<main>

  <!-- Cabeçalho explicativo -->
  <div class="custom-box my-2 mx-0">
    <h3 class="section-title">
      <i class="bi bi-chat-left-heart me-2"></i>
      Conte pra gente...
    </h3>

    <p class="section-text">
      Neste espaço, familiares, amigos e pessoas queridas são convidados a compartilhar lembranças
      significativas vividas ao lado de
      <strong>{{firstName}} {{lastName}}</strong>.
      Aqui construímos juntos uma narrativa afetiva feita de momentos únicos e especiais.
    </p>
    <div class="text-center">
      <a href="#form-compartilhar" class="btn btn-custom-outline rounded-pill px-4 text-center">
        <i class="bi bi-pencil-square me-2"></i> Escrever História
      </a>
    </div>
  </div>


  <!-- Lista de histórias compartilhadas -->
  <div class="custom-box my-2 mx-0 text-start">

    {{#if sharedStory.length}}
    {{#each sharedStory}}

    <div class="life-card">
      <div class="life-content">

        <!-- Imagem no topo (para mobile stacking) -->
        <div class="life-image">
          <img src="{{this.image.url}}" alt="Imagem da história" />
        </div>

        <div class="life-text">
          <h4 class="life-title">{{this.title}}</h4>

          <small class="life-date">
            <i class="bi bi-calendar-event"></i>
            Em {{#if this.eventDate}}{{formatDate this.eventDate "long"}}{{else}}Data não informada{{/if}}
          </small>

          <p class="life-body">
            {{this.content}}
          </p>

          <div class="life-footer">
            <span class="life-author">
              Publicado por <strong>{{this.user.firstName}} {{this.user.lastName}}</strong>
              em {{formatDate this.createdAt "default"}}
            </span>

            <div class="life-actions">
              <a href="/memorial/{{../slug}}/sharedstory/edit/{{this._id}}"
                class="btn btn-custom-outline btn-sm rounded-pill px-3" title="Editar">
                Editar
              </a>

              <form action="/memorial/{{../slug}}/sharedstory/delete/{{this._id}}" method="POST"
                onsubmit="return confirm('Deseja realmente excluir esta história?');">
                <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3" title="Excluir">
                  Excluir
                </button>
              </form>
            </div>

          </div>
        </div>

      </div>
    </div>

    {{/each}}

    {{else}}
    <div class="col-12 py-5 text-center">
      <p class="text-muted"><i class="bi bi-chat-dots me-2"></i>Nenhuma história compartilhada ainda.</p>
    </div>
    {{/if}}

  </div>


  <!-- Formulário igual ao LifeStory -->
  <div id="form-compartilhar" class="mt-2">
    <form action="/memorial/{{slug}}/sharedstory/create" method="POST" enctype="multipart/form-data">

      <input type="hidden" name="memorial" value="{{id}}" />
      <input type="hidden" name="slug" value="{{slug}}" />

      <div class="life-form-box">
        <div class="life-form-card">

          <h3 class="section-title text-center">
            <i class="bi bi-pencil-square me-2"></i>Escrever História
          </h3>

          <!-- Título -->
          <div class="mb-4">
            <label for="storyTitle" class="life-label">
              <i class="bi bi-bookmark-fill me-2"></i>Título da História
            </label>
            <input type="text" id="storyTitle" name="title" class="life-input"
              placeholder="Dê um título para sua lembrança" required>
          </div>

          <!-- Conteúdo -->
          <div class="mb-4">
            <label for="storyContent" class="life-label">
              <i class="bi bi-chat-left-text me-2"></i>Conteúdo
            </label>
            <textarea id="storyContent" name="content" rows="6" class="life-input"
              placeholder="Compartilhe seu momento especial..." required></textarea>
          </div>

          <!-- Data -->
          <div class="mb-4">
            <label for="eventDate" class="life-label">
              <i class="bi bi-calendar-event me-2"></i>Data do Acontecimento
            </label>
            <input type="date" id="eventDate" name="eventDate" class="life-input" required>
          </div>

          <!-- Imagem -->
          <div class="mb-4">
            <label for="storyImage" class="life-label">
              <i class="bi bi-image me-2"></i>Adicionar uma imagem
            </label>
            <input type="file" id="storyImage" name="file" class="life-input" accept="image/*">
          </div>

          <div class="text-center">
            <button type="submit" class="btn btn-custom-outline rounded-pill px-5 shadow-sm">
              <i class="bi bi-send-fill me-2"></i>Enviar
            </button>
          </div>

        </div>
      </div>

    </form>
  </div>

</main>