<main>
  <div class="custom-box p-3 my-3 mx-0">
    <h3 class="mb-4">Editar: Dados do Memorial | Obitu√°rio</h3>

    <form action="/memorial/{{slug}}/memorial/update" method="POST">
      <input type="hidden" name="_method" value="PUT" />

      <!-- Dados principais -->
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label"><strong>Nome</strong></label>
          <input
            type="text"
            class="form-control"
            value="{{firstName}}"
            readonly
          />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label"><strong>Sobrenome</strong></label>
          <input
            type="text"
            class="form-control"
            value="{{lastName}}"
            readonly
          />
        </div>

        <div class="col-md-4 mb-3">
          <label class="form-label">
            <strong>URL</strong>
            <small class="text-muted">inmemoriambrasil.com.br/</small>
          </label>
          <input type="text" class="form-control" value="{{slug}}" readonly />
        </div>
      </div>

      <!-- Parentesco -->
      <fieldset class="mb-4">
        <legend>Parentesco</legend>
        <input
          type="text"
          class="form-control"
          name="kinship"
          value="{{kinship}}"
        />
      </fieldset>

      <!-- Nascimento -->
      <fieldset class="mb-4">
        <legend>üìç Data e Local de Nascimento</legend>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Data</label>
            <input
              type="date"
              class="form-control"
              name="birth[date]"
              value="{{birth.date}}"
            />
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Estado (UF)</label>
            <select
              class="form-select"
              id="birthState"
              name="birth[state]"
              data-selected="{{birth.state}}"
            >
              <option value="">Selecione o estado</option>
            </select>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Cidade</label>
            <select
              class="form-select"
              id="birthCity"
              name="birth[city]"
              data-selected="{{birth.city}}"
            >
              <option value="">Selecione a cidade</option>
            </select>
          </div>
        </div>
      </fieldset>

      <!-- Falecimento -->
      <fieldset class="mb-4">
        <legend>üïäÔ∏è Data e Local de Falecimento</legend>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Data</label>
            <input
              type="date"
              class="form-control"
              name="death[date]"
              value="{{death.date}}"
            />
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Estado (UF)</label>
            <select
              class="form-select"
              id="deathState"
              name="death[state]"
              data-selected="{{death.state}}"
            >
              <option value="">Selecione o estado</option>
            </select>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Cidade</label>
            <select
              class="form-select"
              id="deathCity"
              name="death[city]"
              data-selected="{{death.city}}"
            >
              <option value="">Selecione a cidade</option>
            </select>
          </div>
        </div>
      </fieldset>

      <!-- Obitu√°rio -->
      <fieldset class="mb-4">
        <legend class="fw-bold">Obitu√°rio</legend>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Cemit√©rio</label>
            <input
              type="text"
              class="form-control"
              name="obituary[cemetery]"
              value="{{obituary.cemetery}}"
            />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Endere√ßo da Sepultura</label>
            <input
              type="text"
              class="form-control"
              name="obituary[graveAddress]"
              value="{{obituary.graveAddress}}"
            />
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Local do Vel√≥rio</label>
            <input
              type="text"
              class="form-control"
              name="obituary[wakeLocation]"
              value="{{obituary.wakeLocation}}"
            />
          </div>

          <div class="col-md-3 mb-3">
            <label class="form-label">Data</label>
            <input
              type="date"
              class="form-control"
              name="obituary[wakeDate]"
              value="{{formatDate obituary.wakeDate}}"
            />
          </div>

          <div class="col-md-1 mb-3">
            <label class="form-label">In√≠cio</label>
            <input
              type="text"
              class="form-control"
              name="obituary[wakeStart]"
              value="{{obituary.wakeStart}}"
            />
          </div>

          <div class="col-md-2 mb-3">
            <label class="form-label">T√©rmino</label>
            <input
              type="text"
              class="form-control"
              name="obituary[wakeEnd]"
              value="{{obituary.wakeEnd}}"
            />
          </div>

          <div class="col-12 mb-3">
            <label class="form-label">Mapa do Cemit√©rio</label>
            <input
              type="url"
              class="form-control"
              name="obituary[cemeteryMap]"
              value="{{obituary.cemeteryMap}}"
            />
          </div>
        </div>
      </fieldset>

      <!-- Bot√µes -->
      <div class="d-flex justify-content-end gap-2 mt-4">
        <a href="/memorial/{{slug}}" class="btn-default-memorial">Cancelar</a>
        <button type="submit" class="btn-default-memorial">Atualizar</button>
      </div>
    </form>
  </div>
</main>
<script>
  async function loadStates(selectId) { const select =
  document.getElementById(selectId); const selected = select.dataset.selected;
  const res = await fetch(
  "https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome" );
  const states = await res.json(); states.forEach(state => { const opt =
  document.createElement("option"); opt.value = state.sigla; opt.textContent =
  `${state.nome} (${state.sigla})`; if (state.sigla === selected) opt.selected =
  true; select.appendChild(opt); }); } async function loadCities(stateId,
  cityId) { const stateSelect = document.getElementById(stateId); const
  citySelect = document.getElementById(cityId); const selectedCity =
  citySelect.dataset.selected; async function fetchCities(uf) {
  citySelect.innerHTML = `<option value="">Carregando...</option>`; const res =
  await fetch(
  `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`
  ); const cities = await res.json(); citySelect.innerHTML = `<option
  value="">Selecione a cidade</option>`; cities.forEach(city => { const opt =
  document.createElement("option"); opt.value = city.nome; opt.textContent =
  city.nome; if (city.nome === selectedCity) opt.selected = true;
  citySelect.appendChild(opt); }); } if (stateSelect.value)
  fetchCities(stateSelect.value); stateSelect.addEventListener("change", () => {
  if (stateSelect.value) fetchCities(stateSelect.value); }); } // Inicializa√ß√£o
  loadStates("birthState"); loadStates("deathState"); loadCities("birthState",
  "birthCity"); loadCities("deathState", "deathCity");
</script>